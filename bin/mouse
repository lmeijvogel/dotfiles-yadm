#!/bin/bash

state () {
  local left='3
2
1'


  local right='1
2
3'

  local first_three_mouse_mappings=$(xmodmap -pp | grep -P '\d+\s+\d+' | awk '// { print $2; }' | head -3)

  if [ "$first_three_mouse_mappings" = "$left" ]; then
    echo "left"
  fi
  if [ "$first_three_mouse_mappings" = "$right" ]; then
    echo "right"
  fi
}

format_for_polybar () {
  local click_action="$0 swap"
  local icon

  if [[ "$(state)" == "left" ]]; then
    icon=""
  else
    icon=""
  fi

  echo "%{A1:$click_action:}%{A3:$click_action:}$icon $(state)%{A}%{A}"
}

right () {
  xmodmap -e "pointer = 1 2 3"
}

left () {
  xmodmap -e "pointer = 3 2 1"
}

swap () {
  if [ "$(state)" = "left" ]; then
    right
  else
    if [ "$(state)" = "right" ]; then
      left
    fi
  fi
}

if [ "$1" = "state-polybar" ]; then
  format_for_polybar
elif [ "$1" = "left" ]; then
  left
elif [ "$1" = "right" ]; then
  right
elif [ "$1" = "swap" ]; then
  swap
else
  echo "Usage: $0 (left|right|swap|state-polybar)"
  exit 1
fi

# nvim: ft=bash
